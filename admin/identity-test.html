<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Identity Debug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 0 16px; }
      pre { background: #f5f5f5; padding: 12px; border-radius: 6px; overflow: auto; }
      button { padding: 10px 16px; font-size: 16px; margin: 4px; }
    </style>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <h1>Netlify Identity / Auth0 Debug</h1>
    <p>Натисни бутоните и гледай логовете по-долу.</p>
    <p>
      <button id="btn-open">Open Login</button>
      <button id="btn-logout">Logout</button>
      <button id="btn-clear">Clear logs</button>
    </p>
    <pre id="log"></pre>
    <script>
      const el = document.getElementById('log');
      const log = (...args) => {
        el.textContent += args.map(a => typeof a==='string'?a:JSON.stringify(a,null,2)).join(' ') + '\\n';
        el.scrollTop = el.scrollHeight;
        console.log(...args);
      };
      const ni = window.netlifyIdentity;
      if (!ni) { log('netlifyIdentity not loaded'); }

      ni && ni.on('init', (user) => log('init', user));
      ni && ni.on('login', (user) => log('login', user));
      ni && ni.on('logout', () => log('logout'));
      ni && ni.on('error', (err) => log('error', err && (err.message || err)));
      ni && ni.on('open', () => log('widget open'));
      ni && ni.on('close', () => log('widget close'));

      ni && ni.init();

      document.getElementById('btn-open').onclick = () => { ni && ni.open('login'); };
      document.getElementById('btn-logout').onclick = () => { ni && ni.logout(); };
      document.getElementById('btn-clear').onclick = () => { el.textContent=''; };
    </script>
  </body>
</html>
